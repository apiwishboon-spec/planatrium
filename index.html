<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Journey - Planetarium Intro</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
        // Immediate mode detection to prevent UI flicker
        if (new URLSearchParams(window.location.search).get('mode') === 'program') {
            document.documentElement.classList.add('program-mode');
        }
    </script>
</head>

<body class="director-mode">
    <div id="director-dashboard">
        <!-- Sidebar Controls -->
        <aside class="dashboard-sidebar">
            <div class="logo-area">
                <span class="status-dot pulsing"></span>
                <h1>OPERATIONS COMMAND</h1>
            </div>

            <nav class="scene-nav">
                <h3>SEQUENCE CONTROL</h3>
                <button onclick="window.app.jumpToScene(0)">01. EMERGENCE</button>
                <button onclick="window.app.jumpToScene(1)">02. THE SILENCE</button>
                <button onclick="window.app.jumpToScene(2)">03. STRUCTURES</button>
                <button onclick="window.app.jumpToScene(3)">04. SOLAR SYSTEMS</button>
                <button onclick="window.app.jumpToScene(4)">05. TRANSCENDENCE</button>
                <button onclick="window.app.jumpToScene(5)">06. INFINITY</button>
            </nav>

            <div class="audio-control">
                <h3>VOLUME MASTER</h3>
                <div class="volume-container">
                    <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.4">
                    <span id="volume-readout">40%</span>
                </div>
                <!-- Audio Meter -->
                <div class="audio-meter-container">
                    <div class="meter-labels">
                        <span>0</span>
                        <span>-6</span>
                        <span>-12</span>
                        <span>-18</span>
                        <span>-30</span>
                        <span>-∞</span>
                    </div>
                    <div class="meter-bars">
                        <div class="meter-bar-track">
                            <div id="meter-l" class="meter-bar-fill"></div>
                        </div>
                        <div class="meter-bar-track">
                            <div id="meter-r" class="meter-bar-fill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="fx-panel">
                <h3>MANUAL OVERRIDES</h3>
                <button id="fx-aurora">COMET ZIP</button>
                <button id="fx-supernova">SUPERNOVA</button>
            </div>

            <div class="monitor-controls"
                style="margin-top: auto; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <button onclick="window.app.launchProgramWindow()"
                    style="width: 100%; border-color: #00ff00; color: #00ff00; background: rgba(0,255,0,0.05);">LAUNCH
                    DOME WINDOW</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <header class="dashboard-header">
                <div class="telemetry-item">
                    <span class="label">MISSION CLOCK</span>
                    <span id="time-display">00:00:00</span>
                </div>
                <div class="telemetry-item wide">
                    <span class="label">TIMELINE TRACKER</span>
                    <div id="timeline-progress-container">
                        <div id="timeline-progress-bar"></div>
                    </div>
                </div>
                <div class="telemetry-item">
                    <span class="label">ACTIVE STAGE</span>
                    <span id="current-scene-name">STANDBY</span>
                </div>
                <button id="master-start-btn">ENGAGE MISSION</button>
            </header>

            <section class="visuals-grid">
                <!-- Preview (Director View) -->
                <div class="monitor-frame">
                    <span class="monitor-label">PREVIEW (OPERATIONS)</span>
                    <canvas id="preview-canvas"></canvas>
                </div>

                <!-- Dome Output (Projector) -->
                <div class="monitor-frame program">
                    <span class="monitor-label">PROGRAM (DOME OUTPUT)</span>
                    <canvas id="main-canvas"></canvas>
                </div>
            </section>

            <!-- Script Panel -->
            <footer class="script-panel">
                <div class="script-header">
                    <span>FINALE NARRATION (S.K. PLANETARIUM)</span>
                    <span id="sync-indicator">TELEMETRY SYNC: ACTIVE</span>
                </div>
                <div id="script-content" class="script-scroller">
                    <div class="script-outro">
                        <p class="script-line thai-script" data-start="110">
                            "สวัสดีครับท่านผู้มีเกียรติทุกท่าน ขอต้อนรับเข้าสู่ท้องฟ้าจำลองสิรินธร
                            โรงเรียนสวนกุหลาบวิทยาลัย ในวันนี้ เราจะพาทุกท่านเดินทางไปสู่การสำรวจอวกาศอันกว้างใหญ่ไพศาล
                            ท่ามกลางดวงดาวนับล้านล้านดวง กาแล็กซีอันน่าอัศจรรย์ และความลี้ลับของจักรวาลที่รอคอยการค้นพบ
                            ขอเชิญทุกท่านนั่งพักผ่อน และเตรียมตัวสัมผัสประสบการณ์ที่น่าประทับใจ ณ ท้องฟ้าจำลองแห่งนี้"
                        </p>
                        <p class="script-line eng-script" data-start="125">
                            "Good afternoon, distinguished guests. Welcome to the Sirindhorn Planetarium at Suankularb
                            Wittayalai School. Today, we will take you on an extraordinary journey through the vast
                            expanse of the cosmos, among billions upon billions of stars, magnificent galaxies, and the
                            profound mysteries of the universe waiting to be discovered. Please sit back, relax, and
                            prepare yourself for an unforgettable experience here at our planetarium."
                        </p>
                    </div>
                </div>
            </footer>
        </main>
    </div>

    <!-- Hidden by default now -->
    <div id="welcome-image-container" style="display: none;">
        <img src="welcome.png" id="static-welcome-img" alt="Welcome">
    </div>

    <button id="fullscreen-btn" title="Toggle Fullscreen">
        <svg viewBox="0 0 24 24">
            <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
        </svg>
    </button>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script type="module" src="main.js"></script>
</body>

</html>